
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Five Tips for High Productivity with Matlab</title><meta name="generator" content="MATLAB 8.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-01-11"><meta name="DC.source" content="Ch01_Matlab_Tips.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Five Tips for High Productivity with Matlab</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#3">Five Tips to High Productivity with Matlab</a></li><li><a href="#4">1. Use scripts, cells, and publish to organize and present your work.</a></li><li><a href="#5">2. Adopt a matrix/vector/array/table mindset.</a></li><li><a href="#10">3. Use anonymous functions to work with engineering formulas.</a></li><li><a href="#16">4. Make your functions more useful with element-by-element operations.</a></li><li><a href="#18">5. Use <tt>arrayfun</tt> instead of <tt>for</tt> loops.</a></li></ul></div><h2>Introduction<a name="1"></a></h2><p>Are you making the most of Matlab? Do you dread those homework sets that require you to use Matlab? Does Matlab help you get your work done faster, or does it slow you down?</p><p>These notes present tips for the productive use of Matlab for routine engineering calculations. The idea is to focus on a few techniques that will help you solve routine homework problems more quickly, more accurately, and make Matlab your 'go to' tool for engineering calculations.</p><p><b>Software Requirements</b></p><p>You will need to download and install some additional Matlab functions to run this file. These include:</p><div><ol><li><tt>displaytable</tt>. Located in the Utilities folder in the Matlab Files section of the course web site. Put this function in a convenient place, then apply 'File&gt;Set Path' using the 'Add with Subfolders' options. Save the path.</li></ol></div><h2>Five Tips to High Productivity with Matlab<a name="3"></a></h2><div><ol><li>Use scripts, cells, and publish to organize and present your work.</li><li>Adopt a Matrix/Vector/Array/Table mindset.</li><li>Use anonymous functions to work with engineering formulas.</li><li>Make your functions more useful with element-by-element operations.</li><li>Use <tt>arrayfun</tt> instead of <tt>for</tt> loops whenever possible.</li></ol></div><h2>1. Use scripts, cells, and publish to organize and present your work.<a name="4"></a></h2><p>Scripts provide a way to develop your Matlab projects in an ordered and systematic manner. Scripts are a permanent record of your work, which you can go back and fix, or reuse elements for other projects.</p><p>Some tips:</p><div><ol><li>Exercise and debug your work as you go.</li><li>Use Matlab's publish function to document and present your work.</li><li>Use cells to separate your work into steps.</li></ol></div><pre>     %% Problem P5.34 &lt;-- Major Heading, appears in contents
     % To begin ....</pre><pre>     %%
     % *The next step*  &lt;-- Minor Heading, omitted from contents.</pre><h2>2. Adopt a matrix/vector/array/table mindset.<a name="5"></a></h2><p>Matlab's great feature is that you can work with entire tables of data at once.</p><p>For example, suppose you want to tabulate  values of the <tt>sin</tt> function. Which of the following approaches looks quicker? (by quicker, we mean quicker for you, not for your laptop!)</p><p>This</p><pre class="codeinput">t = 0;
dt = 1;
<span class="keyword">for</span> k = 0:5
    disp([t, sin(t), cos(t)]);
    t = t + dt;
<span class="keyword">end</span>
</pre><pre class="codeoutput">     0     0     1

    1.0000    0.8415    0.5403

    2.0000    0.9093   -0.4161

    3.0000    0.1411   -0.9900

    4.0000   -0.7568   -0.6536

    5.0000   -0.9589    0.2837

</pre><p>or this? (requires <tt>displaytable.m</tt>)</p><pre class="codeinput">t = (0:1:5)';
displaytable([t, sin(t), cos(t)]);
</pre><pre class="codeoutput">       0         0         1
       1   0.84147    0.5403
       2    0.9093  -0.41615
       3   0.14112  -0.98999
       4   -0.7568  -0.65364
       5  -0.95892   0.28366

</pre><p>Some pointers --</p><div><ul><li>Download <tt>displaytable</tt> from the course webpage. It is located in the Utilities folder under 'Matlab Files'.</li></ul></div><div><ul><li>With the element-by-element <tt>.^</tt>, Matlab can compute a whole vector of data at time? <tt>t</tt> is a vector, and the <tt>sin</tt> function computes a value for each element of <tt>t</tt>. No need to write a <tt>for</tt> loop.</li></ul></div><div><ul><li>The vector can be organized as a row or as a column. Here we used <tt>'</tt> to turn a row vector into a column.</li></ul></div><div><ul><li><tt>t(:)</tt> is <b>always</b> a column vector.</li></ul></div><div><ul><li>Use <tt>[,]</tt> to assemble columns into an array, or <tt>[;]</tt> to assemble rows into an array.</li></ul></div><p>It's easy to plot and display vectors and arrays of data. Using vectors, you can plot and add labels</p><pre class="codeinput">t = 0:.01:5;
plot(t,sin(t),t,cos(t));
xlabel(<span class="string">'Time [sec]'</span>);
ylabel(<span class="string">'Value [volts]'</span>);
legend({<span class="string">'Sin'</span>,<span class="string">'Cos'</span>});
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_01.png" alt=""> <p>Use <tt>displaytable</tt> to conveniently display tables of data with row and column headers.</p><pre class="codeinput">addpath(<span class="string">'utilities'</span>);
t = (0:1:5)';
displaytable([t,sin(t),cos(t)],<span class="string">''</span>,{<span class="string">'t [sec]'</span>,<span class="string">'Sin(t)'</span>,<span class="string">'Cos(t)'</span>});
</pre><pre class="codeoutput"> t [sec]    Sin(t)    Cos(t)
       0         0         1
       1   0.84147    0.5403
       2    0.9093  -0.41615
       3   0.14112  -0.98999
       4   -0.7568  -0.65364
       5  -0.95892   0.28366

</pre><h2>3. Use anonymous functions to work with engineering formulas.<a name="10"></a></h2><p>Anonymous functions are simple, easy to use, and can be included directly into your scripts without needing additional files. Often they are all you need to work with engineering equations in Matlab.</p><p><b>Example: Normal boiling point of oxygen using Antoine's equation.</b></p><pre class="codeinput"><span class="comment">% Antoine's Equation: Saturation Pressure [mmHg] vs. Temperature [deg C]</span>
PsatO2 = @(T) 10^(6.69144 - 319.013/(T + 266.697));

<span class="comment">% Use fzero to solve for boiling point where PsatO2(T) = 760 mmHg</span>
Tboil = fzero(@(T)PsatO2(T) - 760, [-200]);

<span class="comment">% Display result</span>
displaytable(Tboil,<span class="string">'Normal boiling point of Oxygen [deg C] = '</span>);
</pre><pre class="codeoutput">Normal boiling point of Oxygen [deg C] =   -182.98

</pre><p><b>Example: Bubble and dew points using the Rachford-Rice equation</b></p><p>This next example shows how a series of anonymous functions can be combined to build up quite complex expressions.</p><pre class="codeinput"><span class="comment">% Antoine's equations</span>
PsatO2 = @(T) 10^(6.69144 - 319.013/(T + 266.697));
PsatN2 = @(T) 10^(6.49457 - 255.68/(T + 266.55));

<span class="comment">% K-value functions</span>
KO2 = @(T,P) PsatO2(T)/P;
KN2 = @(T,P) PsatN2(T)/P;

<span class="comment">% Rachford-Rice equation</span>
RR = @(T,P,phi) 0.2*(KO2(T,P)-1)/(1 + phi*(KO2(T,P)-1)) + <span class="keyword">...</span>
                0.8*(KN2(T,P)-1)/(1 + phi*(KN2(T,P)-1));

<span class="comment">% Solve RR(T,P,phi) = 0 for bubble and dew points at 760 mmHg</span>
P = 760;
Tbubble = fzero(@(T) RR(T,P,0), -150);
Tdew = fzero(@(T) RR(T,P,1), -150);

<span class="comment">% Display results</span>
displaytable([Tbubble;Tdew],{<span class="string">'Bubble Pt. [deg C]'</span>,<span class="string">'Dew Pt. [deg C]'</span>})
</pre><pre class="codeoutput">Bubble Pt. [deg C]  -194.31
Dew Pt. [deg C]     -191.19

</pre><p><b>Example: Solve a differential equation using <tt>ode45</tt></b></p><p>Here's a simple model for the growth of a bacterial culture in a chemostat with Monod kinetics. The example demostrates the use of an anonymous function to model the chemostat, followed by another use of the anonymous function to pass the model to <tt>ode45</tt> with the right arguments.</p><pre class="codeinput"><span class="comment">% Model parameters</span>
k1 = 0.67;
k2 = 1.20;
D  = 0.2;

<span class="comment">% Chemostat model</span>
f = @(c) -D*c + k1*c/(k2 + c);

<span class="comment">% Reshape the model to fit the requirements of ode45</span>
tspan = [0 100];
c0 = 1.2;
[tout,cout] = ode45(@(t,c)f(c),tspan,c0);

<span class="comment">% Display the results</span>
plot(tout,cout);
xlabel(<span class="string">'Time'</span>);
ylabel(<span class="string">'Bacteria Concentration'</span>);
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_02.png" alt=""> <p><b>Example: Solving a coupled pair of differential equations</b></p><p>A model for the population dynamics of Hare and Lynx is given in the textbook by Astrom and Murry.</p><pre class="codeinput"><span class="comment">% Parameter values</span>

a = 3.2;
b = 0.6;
c = 50;
d = 0.56;
k = 125;     <span class="comment">% Carry Capacity for Hares</span>
r = 1.6;

<span class="comment">% Note that parameter values are fixed when the function handles are</span>
<span class="comment">% specified.</span>

fH = @(H,L) r*H*(1-H/k) - a*H*L/(c+H);
fL = @(H,L) b*a*H.*L/(c+H) - d*L;

f = @(t,x) [fH(x(1),x(2));fL(x(1),x(2))];

<span class="comment">% Preditor-Prey systems frequently demonstrate _Limit Cycle_ behavior</span>
<span class="comment">% identified as a sustained cyclic rep</span>

x0 = [20;20];
tspan = [0 100];
ode45(f,tspan,x0);

<span class="comment">% The following dress the plot up for presentation</span>
xlabel(<span class="string">'Time'</span>);
ylabel(<span class="string">'Population'</span>);
title(<span class="string">'Hare/Lynx Dynamics'</span>);
legend(<span class="string">'Hare'</span>,<span class="string">'Lynx'</span>,<span class="string">'Location'</span>,<span class="string">'NorthWest'</span>);
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_03.png" alt=""> <p>Phase Plane</p><p>The phase plane is the same information plotted in the <i>state-space</i> coordinates.</p><pre class="codeinput">[t,x] = ode45(f,tspan,x0);
plot(x(:,1),x(:,2));
<span class="comment">% comet(x(:,1),x(:,2));</span>

xlabel(<span class="string">'Hare Population'</span>);
ylabel(<span class="string">'Lynx Population'</span>);
title(<span class="string">'Hare Lynx Dynamics shown in the Phase Plane'</span>);
grid;
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_04.png" alt=""> <h2>4. Make your functions more useful with element-by-element operations.<a name="16"></a></h2><p>The version of <tt>PsatO2(T)</tt> above will  calculate the saturation pressure for one value of <tt>T</tt> at a time. Often you want to obtain values for many values of <tt>T</tt>, preferably without having to write <tt>for</tt> loops.</p><p>The trick is use element-by-element versions of the basic Matlab operators <tt>*</tt>, <tt>/</tt>, and <tt>^</tt>.  Normally these are matrix operations. Adding a '.' forms the element-by-element operators <tt>.*</tt>, <tt>./</tt>, and <tt>.^</tt>. This causes your functions to behave like Matlab's builtin functions such as <tt>sin</tt> and <tt>cos</tt>.</p><p><b>Example: Plot the Saturation Pressure of Oxygen and Nitrogen vs. Temp.</b></p><pre class="codeinput">PsatO2 = @(T) 10.^(6.69144 - 319.013./(T + 266.697));
PsatN2 = @(T) 10.^(6.49457 - 255.68./(T + 266.55));

T = -200:-150;
plot(T,PsatO2(T),T,PsatN2(T));
xlabel(<span class="string">'Temperature [C]'</span>);
ylabel(<span class="string">'Pressure [mmHg]'</span>);
title(<span class="string">'Saturation Pressure for Oxygen and Nitrogen'</span>);
legend({<span class="string">'Oxygen'</span>,<span class="string">'Nitrogen'</span>});
grid
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_05.png" alt=""> <h2>5. Use <tt>arrayfun</tt> instead of <tt>for</tt> loops.<a name="18"></a></h2><p>Repetitive calculations are required for many engeineering uses, such as creating plots, data tables, or parametric studies. <tt>for</tt> loops are traditionally used for this purpose, but they take time to set up and debug.</p><p><tt>arrayfun</tt> provides a quick way to do simple repetitive calculations in a single line.  Save the <tt>for</tt> loop for more complex situations where it is really necessary.</p><p><b>Example: Compute eigenvalues of a matrix as a function a parameter.</b></p><pre class="codeinput"><span class="comment">% Matrix as a function of x</span>
A = @(x) [ x 2 0; 2 0 1; 0 1 x];

<span class="comment">% Range of values</span>
x = 0:0.1:10;

<span class="comment">% Use arrayfun to compute max and min eigenvalues for each value of x</span>
emax = arrayfun(@(x)max(eig(A(x))),x);
emin = arrayfun(@(x)min(eig(A(x))),x);

<span class="comment">% Display results</span>
plot(x,emax,x,emin);
xlabel(<span class="string">'x'</span>);
ylabel(<span class="string">'Max and Min Eigenvalue'</span>);
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_06.png" alt=""> <p><b>Example: Parametric plotting with <tt>arrayfun</tt></b></p><pre class="codeinput"><span class="comment">% A function of t and a parameter w</span>
f = @(t,w) exp(-t).*sin(w*t);

<span class="comment">% Select a range of values for t, and for parameter w</span>
t = 0:.01:5;
w = 0:.2:1;

<span class="comment">% Create multiple plots</span>
clf;
hold <span class="string">on</span>
arrayfun(@(w) plot(t,f(t,w)), w)
hold <span class="string">off</span>
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_07.png" alt=""> <p><b>Example: Simulate a chemostat as a function of dilution rates</b></p><pre class="codeinput"><span class="comment">% Model parameters</span>
k1 = 0.67;
k2 = 1.20;
D  = 0.2;

<span class="comment">% Chemostat model as a function of c and D</span>
f = @(c,D) -D*c + k1*c/(k2 + c);

<span class="comment">% Reshape the model to fit the requirements of ode45</span>
tspan = [0 100];
c0 = 1.2;

<span class="comment">% Setup ode45 to plot c(t) for given value of the dilution rate</span>
simulate = @(D) ode45(@(t,c) f(c,D), tspan, c0);

<span class="comment">% Choose a range of dilution rates</span>
D = 0.05:.05:0.5;

<span class="comment">% Overlay plots for each value of D</span>
hold <span class="string">on</span>
arrayfun(@(D)simulate(D),D);
hold <span class="string">off</span>

<span class="comment">% Set and label axes</span>
axis([0 100 0 15]);
xlabel(<span class="string">'Time'</span>);
ylabel(<span class="string">'Concentration'</span>);
</pre><img vspace="5" hspace="5" src="Ch01_Matlab_Tips_08.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Five Tips for High Productivity with Matlab
%

%% Introduction
%
% Are you making the most of Matlab? Do you dread those homework sets that
% require you to use Matlab? Does Matlab help you get your work
% done faster, or does it slow you down? 
%
% These notes present tips for the productive use of Matlab for routine
% engineering calculations. The idea is to focus on a few techniques that
% will help you solve routine homework problems more quickly, more
% accurately, and make Matlab your 'go to' tool for engineering
% calculations.

%%
% *Software Requirements*
%
% You will need to download and install some additional Matlab functions to
% run this file. These include:
%
% # |displaytable|. Located in the Utilities folder in the Matlab Files
% section of the course web site. Put this function in a convenient place,
% then apply 'File>Set Path' using the 'Add with Subfolders' options. Save
% the path.


%% Five Tips to High Productivity with Matlab
%  
% # Use scripts, cells, and publish to organize and present your work.
% # Adopt a Matrix/Vector/Array/Table mindset.
% # Use anonymous functions to work with engineering formulas.
% # Make your functions more useful with element-by-element operations.
% # Use |arrayfun| instead of |for| loops whenever possible.

%% 1. Use scripts, cells, and publish to organize and present your work.
%
% Scripts provide a way to develop your Matlab projects in an ordered and
% systematic manner. Scripts are a permanent record of your work, which you
% can go back and fix, or reuse elements for other projects.
%
% Some tips:
%
% # Exercise and debug your work as you go. 
% # Use Matlab's publish function to document and present your work. 
% # Use cells to separate your work into steps.
% 
%       %% Problem P5.34 <REPLACE_WITH_DASH_DASH Major Heading, appears in contents
%       % To begin ....
%      
%       %%
%       % *The next step*  <REPLACE_WITH_DASH_DASH Minor Heading, omitted from contents.
%

%% 2. Adopt a matrix/vector/array/table mindset.
%
% Matlab's great feature is that you can work with entire tables of data at
% once.
%
% For example, suppose you want to tabulate  values of the |sin|
% function. Which of the following approaches looks quicker? (by quicker,
% we mean quicker for you, not for your laptop!)
%
% This

t = 0;
dt = 1;
for k = 0:5
    disp([t, sin(t), cos(t)]);
    t = t + dt;
end

%%
% or this? (requires |displaytable.m|)

t = (0:1:5)';
displaytable([t, sin(t), cos(t)]);


%%
% Some pointers REPLACE_WITH_DASH_DASH 
%
% * Download |displaytable| from the course webpage. It is located in the
% Utilities folder under 'Matlab Files'.
%
% * With the element-by-element |.^|, Matlab can compute a whole vector of data at time? |t|
% is a vector, and the |sin| function computes a value for each element of
% |t|. No need to write a |for| loop.
%
% * The vector can be organized as a row or as a column. Here we used |'|
% to turn a row vector into a column.
%
% * |t(:)| is *always* a column vector.
%
% * Use |[,]| to assemble columns into an array, or |[;]| to assemble rows
% into an array.

%% 
% It's easy to plot and display vectors and arrays of data.
% Using vectors, you can plot and add labels

t = 0:.01:5;
plot(t,sin(t),t,cos(t));
xlabel('Time [sec]');
ylabel('Value [volts]');
legend({'Sin','Cos'});

%%
% Use |displaytable| to conveniently display tables of data with row and
% column headers.

addpath('utilities');
t = (0:1:5)';
displaytable([t,sin(t),cos(t)],'',{'t [sec]','Sin(t)','Cos(t)'});

%% 3. Use anonymous functions to work with engineering formulas.
%
% Anonymous functions are simple, easy to use, and can be included directly
% into your scripts without needing additional files. Often they are all
% you need to work with engineering equations in Matlab.
%

%%
% *Example: Normal boiling point of oxygen using Antoine's
% equation.*

% Antoine's Equation: Saturation Pressure [mmHg] vs. Temperature [deg C]
PsatO2 = @(T) 10^(6.69144 - 319.013/(T + 266.697));

% Use fzero to solve for boiling point where PsatO2(T) = 760 mmHg
Tboil = fzero(@(T)PsatO2(T) - 760, [-200]);

% Display result
displaytable(Tboil,'Normal boiling point of Oxygen [deg C] = ');

%%
% *Example: Bubble and dew points using the Rachford-Rice equation*
%
% This next example shows how a series of anonymous functions can be
% combined to build up quite complex expressions.

% Antoine's equations
PsatO2 = @(T) 10^(6.69144 - 319.013/(T + 266.697));
PsatN2 = @(T) 10^(6.49457 - 255.68/(T + 266.55));

% K-value functions
KO2 = @(T,P) PsatO2(T)/P;
KN2 = @(T,P) PsatN2(T)/P;

% Rachford-Rice equation
RR = @(T,P,phi) 0.2*(KO2(T,P)-1)/(1 + phi*(KO2(T,P)-1)) + ...
                0.8*(KN2(T,P)-1)/(1 + phi*(KN2(T,P)-1));

% Solve RR(T,P,phi) = 0 for bubble and dew points at 760 mmHg
P = 760;
Tbubble = fzero(@(T) RR(T,P,0), -150);
Tdew = fzero(@(T) RR(T,P,1), -150);

% Display results
displaytable([Tbubble;Tdew],{'Bubble Pt. [deg C]','Dew Pt. [deg C]'})


%%
% *Example: Solve a differential equation using |ode45|*
%
% Here's a simple model for the growth of a bacterial culture in a
% chemostat with Monod kinetics. The example demostrates the use of an
% anonymous function to model the chemostat, followed by another use of the
% anonymous function to pass the model to |ode45| with the right arguments.

% Model parameters
k1 = 0.67;
k2 = 1.20;
D  = 0.2;

% Chemostat model
f = @(c) -D*c + k1*c/(k2 + c);

% Reshape the model to fit the requirements of ode45
tspan = [0 100];
c0 = 1.2;
[tout,cout] = ode45(@(t,c)f(c),tspan,c0);

% Display the results
plot(tout,cout);
xlabel('Time');
ylabel('Bacteria Concentration');

%% 
% *Example: Solving a coupled pair of differential equations*
%
% A model for the population dynamics of Hare and Lynx is given in the
% textbook by Astrom and Murry. 

% Parameter values

a = 3.2;
b = 0.6;
c = 50;
d = 0.56;
k = 125;     % Carry Capacity for Hares
r = 1.6;

% Note that parameter values are fixed when the function handles are
% specified.

fH = @(H,L) r*H*(1-H/k) - a*H*L/(c+H);
fL = @(H,L) b*a*H.*L/(c+H) - d*L;

f = @(t,x) [fH(x(1),x(2));fL(x(1),x(2))];

% Preditor-Prey systems frequently demonstrate _Limit Cycle_ behavior
% identified as a sustained cyclic rep

x0 = [20;20];
tspan = [0 100];
ode45(f,tspan,x0);

% The following dress the plot up for presentation
xlabel('Time');
ylabel('Population');
title('Hare/Lynx Dynamics');
legend('Hare','Lynx','Location','NorthWest');

%%
% Phase Plane
%
% The phase plane is the same information plotted in the _state-space_
% coordinates.

[t,x] = ode45(f,tspan,x0);
plot(x(:,1),x(:,2));
% comet(x(:,1),x(:,2));

xlabel('Hare Population');
ylabel('Lynx Population');
title('Hare Lynx Dynamics shown in the Phase Plane');
grid;


%% 4. Make your functions more useful with element-by-element operations.
%
% The version of |PsatO2(T)| above will  calculate the saturation pressure
% for one value of |T| at a time. Often you want to obtain values for many
% values of |T|, preferably without having to write |for| loops.
%
% The trick is use element-by-element versions of the basic Matlab
% operators |*|, |/|, and |^|.  Normally these are matrix operations.
% Adding a '.' forms the element-by-element operators |.*|, |./|, and |.^|.
% This causes your functions to behave like Matlab's builtin functions such
% as |sin| and |cos|.

%%
% *Example: Plot the Saturation Pressure of Oxygen and Nitrogen vs. Temp.*

PsatO2 = @(T) 10.^(6.69144 - 319.013./(T + 266.697));
PsatN2 = @(T) 10.^(6.49457 - 255.68./(T + 266.55));

T = -200:-150;
plot(T,PsatO2(T),T,PsatN2(T));
xlabel('Temperature [C]');
ylabel('Pressure [mmHg]');
title('Saturation Pressure for Oxygen and Nitrogen');
legend({'Oxygen','Nitrogen'});
grid

%% 5. Use |arrayfun| instead of |for| loops.
%
% Repetitive calculations are required for many engeineering uses, such as
% creating plots, data tables, or parametric studies. |for| loops are
% traditionally used for this purpose, but they take time to set up and
% debug.
% 
% |arrayfun| provides a quick way to do simple repetitive calculations in a
% single line.  Save the |for| loop for more complex situations where it is
% really necessary.

%% 
% *Example: Compute eigenvalues of a matrix as a function a parameter.*

% Matrix as a function of x
A = @(x) [ x 2 0; 2 0 1; 0 1 x];

% Range of values
x = 0:0.1:10;

% Use arrayfun to compute max and min eigenvalues for each value of x
emax = arrayfun(@(x)max(eig(A(x))),x);
emin = arrayfun(@(x)min(eig(A(x))),x);

% Display results
plot(x,emax,x,emin);
xlabel('x');
ylabel('Max and Min Eigenvalue');

%%
% *Example: Parametric plotting with |arrayfun|*

% A function of t and a parameter w
f = @(t,w) exp(-t).*sin(w*t);

% Select a range of values for t, and for parameter w
t = 0:.01:5;
w = 0:.2:1;

% Create multiple plots
clf;
hold on
arrayfun(@(w) plot(t,f(t,w)), w)
hold off

%%
% *Example: Simulate a chemostat as a function of dilution rates*

% Model parameters
k1 = 0.67;
k2 = 1.20;
D  = 0.2;

% Chemostat model as a function of c and D
f = @(c,D) -D*c + k1*c/(k2 + c);

% Reshape the model to fit the requirements of ode45
tspan = [0 100];
c0 = 1.2;

% Setup ode45 to plot c(t) for given value of the dilution rate
simulate = @(D) ode45(@(t,c) f(c,D), tspan, c0);

% Choose a range of dilution rates
D = 0.05:.05:0.5;

% Overlay plots for each value of D
hold on
arrayfun(@(D)simulate(D),D);
hold off

% Set and label axes
axis([0 100 0 15]);
xlabel('Time');
ylabel('Concentration');


##### SOURCE END #####
--></body></html>